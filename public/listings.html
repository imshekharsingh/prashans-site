<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Prashans Stays – Listings</title>
  <link rel="stylesheet" href="/assets/css/style.css" />

  <!-- ✅ Content Security Policy (allow Worker + images + inline script) -->
  <meta
    http-equiv="Content-Security-Policy"
    content="
      default-src 'self';
      script-src 'self' 'unsafe-inline';
      connect-src 'self' https://prashans-edge-production.shekhar-singh20.workers.dev;
      img-src 'self' https://images.unsplash.com data:;
      style-src 'self' 'unsafe-inline';
    "
  />
</head>

<body>
  <header class="site-header">
    <div class="container header-content">
      <h1 class="brand">Prashans Stays</h1>
      <nav>
        <a href="/index.html">Home</a>
        <a href="/listings.html" class="active">Listings</a>
        <a href="/demo/edge.html">Demo</a>
      </nav>
    </div>
  </header>

  <main class="container">
    <section class="intro">
      <h2>Discover Beautiful Places to Stay</h2>
      <p>Handpicked stays — from cozy cottages to luxury villas. Find your next getaway below.</p>
    </section>

    <section id="listing-grid" class="listing-grid">
      <div class="loading">Loading listings...</div>
    </section>
  </main>

  <footer class="site-footer">
    <p>© 2025 Prashans Stays · Built with ❤️ and Cloudflare Edge</p>
  </footer>

  <script>
    async function loadListings() {
      try {
        const response = await fetch('https://prashans-edge-production.shekhar-singh20.workers.dev/api/listings');
        if (!response.ok) throw new Error('Failed to fetch listings');
        const listings = await response.json();

        const grid = document.getElementById('listing-grid');
        grid.innerHTML = '';

        listings.forEach(l => {
          const card = document.createElement('div');
          card.className = 'listing-card';
          card.innerHTML = `
            <div class="image-wrapper">
              <img src="${l.image}" alt="${l.name}">
              <span class="price-tag">${l.price || '$99/night'}</span>
            </div>
            <div class="listing-info">
              <h3>${l.name}</h3>
              <p class="location">${l.location || 'Unknown location'}</p>
              <p class="details">${l.details}</p>
              <button class="book-btn">Book Now</button>
            </div>
          `;
          grid.appendChild(card);
        });
      } catch (err) {
        document.getElementById('listing-grid').innerHTML =
          `<p class="error">Unable to load listings. Please try again later.</p>`;
        console.error(err);
      }
    }

    loadListings();
  </script>
</body>
</html>
